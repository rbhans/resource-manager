<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resource Library</title>
    <meta name="description" content="SharePoint Training Resource Library">
    <meta name="theme-color" content="#0078d4">
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIlRyYWluaW5nIFJlc291cmNlIExpYnJhcnkiLAogICJzaG9ydF9uYW1lIjogIlJlc291cmNlcyIsCiAgImRlc2NyaXB0aW9uIjogIlNoYXJlUG9pbnQgVHJhaW5pbmcgUmVzb3VyY2UgTGlicmFyeSIsCiAgInN0YXJ0X3VybCI6ICIvIiwKICAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwKICAidGhlbWVfY29sb3IiOiAiIzAwNzhkNCIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiI2YzZjJmMSIsCiAgImljb25zIjogWwogICAgewogICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjNhV1IwYUQwaU1Ua3lJaUJvWldsbmFIUTlJakU1TWlJZ2RtbGxkMEp2ZUQwaU1DQXdJREU1TWlBeE9USWlJSGh0Ykc1elBTSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OHlNREF3TDNOMlp5SStQSEpsWTNRZ2QybGtkR2c5SWpFNU1pSWdhR1ZwWjJoMFBTSXhPVElpSUdacGJHdzlJaU13TURjNFpEUWlMejQ4Y0dGMGFDQmtQU0pOTmpRZ05EQm9OalJqTVRjdU55QXdJRE15SURFMExqTWdNeklnTXpKMk5qUmpNQ0F4Tnk0M0xURTBMak1nTXpJdE16SWdNekpJTmpSak1UY3VOeTB3SURNeUxURTBMak1nTXpJdE16SldOekpqTUMweE55NDNMVEV5TGpNdE16SXRNekl0TXpKNklpQm1hV3hzUFNJalptWm1JaTgrUEM5emRtYysiLAogICAgICAic2l6ZXMiOiAiMTkyeDE5MiIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9CiAgXQp9">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Microsoft Design System Variables */
        :root {
            --ms-primary: #0078d4;
            --ms-primary-hover: #106ebe;
            --ms-white: #ffffff;
            --ms-gray-10: #faf9f8;
            --ms-gray-20: #f3f2f1;
            --ms-gray-30: #edebe9;
            --ms-gray-40: #e1dfdd;
            --ms-gray-130: #605e5c;
            --ms-gray-160: #323130;
            --ms-font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            --ms-radius: 2px;
        }

        body {
            font-family: var(--ms-font-family);
            background: var(--ms-gray-20);
            color: var(--ms-gray-160);
            font-size: 14px;
            line-height: 20px;
        }

        /* Top Bar */
        .top-bar {
            background: var(--ms-primary);
            color: var(--ms-white);
            padding: 0 20px;
            height: 48px;
            display: flex;
            align-items: center;
            font-size: 16px;
            font-weight: 600;
        }

        .top-bar-icon {
            margin-right: 12px;
            font-size: 20px;
        }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* Page Header */
        .page-header {
            background: var(--ms-white);
            padding: 32px;
            margin-bottom: 20px;
            border: 1px solid var(--ms-gray-30);
        }

        .page-title {
            font-size: 32px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .page-subtitle {
            color: var(--ms-gray-130);
        }

        /* Action Bar */
        .action-bar {
            background: var(--ms-white);
            border: 1px solid var(--ms-gray-30);
            padding: 12px 16px;
            margin-bottom: 20px;
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 5px 12px;
            height: 32px;
            background: var(--ms-white);
            border: 1px solid var(--ms-gray-40);
            color: var(--ms-gray-160);
            font-size: 14px;
            font-family: var(--ms-font-family);
            cursor: pointer;
            transition: all 0.1s;
            border-radius: var(--ms-radius);
        }

        .btn:hover {
            background: var(--ms-gray-10);
            border-color: var(--ms-gray-130);
        }

        .btn-primary {
            background: var(--ms-primary);
            border-color: var(--ms-primary);
            color: var(--ms-white);
            font-weight: 600;
        }

        .btn-primary:hover {
            background: var(--ms-primary-hover);
            border-color: var(--ms-primary-hover);
        }

        /* Search Section */
        .search-section {
            background: var(--ms-white);
            border: 1px solid var(--ms-gray-30);
            padding: 20px;
            margin-bottom: 20px;
        }

        .search-box {
            position: relative;
            margin-bottom: 16px;
        }

        .search-input {
            width: 100%;
            max-width: 400px;
            padding: 6px 12px 6px 32px;
            border: 1px solid var(--ms-gray-40);
            border-radius: var(--ms-radius);
            font-size: 14px;
            height: 32px;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--ms-primary);
        }

        .search-icon {
            position: absolute;
            left: 10px;
            top: 8px;
            color: var(--ms-gray-130);
            pointer-events: none;
        }

        .tag-filters {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .tag-filter {
            padding: 4px 12px;
            background: var(--ms-gray-10);
            border: 1px solid var(--ms-gray-40);
            border-radius: 16px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.1s;
        }

        .tag-filter:hover {
            background: var(--ms-gray-20);
        }

        .tag-filter.active {
            background: var(--ms-primary);
            border-color: var(--ms-primary);
            color: var(--ms-white);
        }

        /* Resource List */
        .resource-list {
            background: var(--ms-white);
            border: 1px solid var(--ms-gray-30);
        }

        .list-header {
            display: grid;
            grid-template-columns: 48px 1fr 120px 200px 100px;
            padding: 12px 16px;
            background: var(--ms-gray-10);
            border-bottom: 1px solid var(--ms-gray-30);
            font-size: 12px;
            font-weight: 600;
            color: var(--ms-gray-130);
        }

        .list-item {
            display: grid;
            grid-template-columns: 48px 1fr 120px 200px 100px;
            padding: 12px 16px;
            border-bottom: 1px solid var(--ms-gray-20);
            align-items: center;
            transition: background 0.1s;
        }

        .list-item:hover {
            background: var(--ms-gray-10);
        }

        .list-item:last-child {
            border-bottom: none;
        }

        .item-icon {
            width: 32px;
            height: 32px;
            background: var(--ms-primary);
            color: var(--ms-white);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--ms-radius);
        }

        .item-title {
            font-weight: 400;
            color: var(--ms-gray-160);
        }

        .item-type {
            color: var(--ms-gray-130);
            font-size: 12px;
        }

        .item-tags {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
        }

        .item-tag {
            padding: 2px 8px;
            background: var(--ms-gray-20);
            border-radius: 10px;
            font-size: 11px;
            color: var(--ms-gray-130);
        }

        .item-actions {
            display: flex;
            gap: 4px;
        }

        .icon-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: 1px solid transparent;
            border-radius: var(--ms-radius);
            color: var(--ms-gray-130);
            cursor: pointer;
            transition: all 0.1s;
        }

        .icon-btn:hover {
            background: var(--ms-gray-20);
            border-color: var(--ms-gray-40);
        }

        /* Empty State */
        .empty-state {
            padding: 80px 40px;
            text-align: center;
            background: var(--ms-white);
            border: 1px solid var(--ms-gray-30);
        }

        .empty-icon {
            font-size: 48px;
            color: var(--ms-gray-40);
            margin-bottom: 16px;
        }

        .empty-title {
            font-size: 20px;
            margin-bottom: 8px;
        }

        .empty-text {
            color: var(--ms-gray-130);
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: 1000;
        }

        .modal-overlay.active {
            display: block;
        }

        .modal {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100%;
            background: var(--ms-white);
            box-shadow: -2px 0 8px rgba(0, 0, 0, 0.15);
            transition: right 0.3s;
            z-index: 1001;
            display: flex;
            flex-direction: column;
        }

        .modal.active {
            right: 0;
        }

        .modal.wide {
            width: 90%;
            max-width: 1200px;
            right: -100%;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--ms-gray-30);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }

        .modal-close {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            color: var(--ms-gray-130);
            cursor: pointer;
            font-size: 20px;
        }

        .modal-close:hover {
            background: var(--ms-gray-20);
        }

        .modal-body {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .modal-footer {
            padding: 16px 20px;
            border-top: 1px solid var(--ms-gray-30);
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 4px;
            font-weight: 600;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 6px 12px;
            border: 1px solid var(--ms-gray-40);
            border-radius: var(--ms-radius);
            font-size: 14px;
            height: 32px;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--ms-primary);
        }

        .form-help {
            margin-top: 4px;
            font-size: 12px;
            color: var(--ms-gray-130);
        }

        .tag-selector {
            border: 1px solid var(--ms-gray-40);
            border-radius: var(--ms-radius);
            padding: 8px;
            min-height: 40px;
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }

        .tag-option {
            padding: 4px 10px;
            background: var(--ms-gray-10);
            border: 1px solid var(--ms-gray-40);
            border-radius: 12px;
            font-size: 12px;
            cursor: pointer;
        }

        .tag-option.selected {
            background: var(--ms-primary);
            border-color: var(--ms-primary);
            color: var(--ms-white);
        }

        /* Tag List */
        .tag-list {
            border: 1px solid var(--ms-gray-30);
            border-radius: var(--ms-radius);
            max-height: 300px;
            overflow-y: auto;
        }

        .tag-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid var(--ms-gray-20);
        }

        .tag-list-item:last-child {
            border-bottom: none;
        }

        /* Viewer */
        .viewer-frame {
            width: 100%;
            height: calc(100vh - 100px);
            border: none;
        }

        /* Message */
        .message {
            position: fixed;
            top: 60px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: var(--ms-white);
            padding: 12px 20px;
            border-radius: var(--ms-radius);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 2000;
            transition: transform 0.3s;
            border-left: 4px solid var(--ms-primary);
        }

        .message.show {
            transform: translateX(-50%) translateY(0);
        }

        .message.error {
            border-left-color: #d83b01;
        }

        .message.success {
            border-left-color: #107c10;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 20px 10px;
            }
            
            .list-header,
            .list-item {
                grid-template-columns: 48px 1fr;
            }
            
            .list-header > *:nth-child(n+3),
            .list-item > *:nth-child(n+3) {
                display: none;
            }
            
            .modal {
                width: 100%;
                right: -100%;
            }
        }
    </style>
</head>
<body>
    <!-- Top Bar -->
    <div class="top-bar">
        <span class="top-bar-icon">📚</span>
        <span>Training Resource Library</span>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">Resources</h1>
            <p class="page-subtitle">Centralized tagged hub for sharepoint resources.</p>
        </div>

        <!-- Action Bar -->
        <div class="action-bar">
            <button class="btn btn-primary" onclick="openAddModal()">
                ➕ New
            </button>
            <button class="btn" onclick="openTagModal()">
                🏷️ Manage tags
            </button>
            <button class="btn" onclick="exportData()">
                💾 Export
            </button>
            <button class="btn" onclick="document.getElementById('importFile').click()">
                📁 Import
            </button>
            <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
        </div>

        <!-- Search Section -->
        <div class="search-section">
            <div class="search-box">
                <span class="search-icon">🔍</span>
                <input type="text" class="search-input" id="searchInput" placeholder="Search documents" oninput="filterResources()">
            </div>
            <div class="tag-filters" id="tagFilters"></div>
        </div>

        <!-- Resource List -->
        <div class="resource-list" id="resourceList">
            <div class="list-header">
                <div>Type</div>
                <div>Name</div>
                <div>Type</div>
                <div>Tags</div>
                <div>Actions</div>
            </div>
            <div id="resourceItems"></div>
        </div>

        <!-- Empty State -->
        <div class="empty-state" id="emptyState" style="display: none;">
            <div class="empty-icon">📁</div>
            <div class="empty-title">No documents yet</div>
            <div class="empty-text">Create your first resource to get started</div>
        </div>
    </div>

    <!-- Message -->
    <div id="message" class="message"></div>

    <!-- Modals -->
    <div id="modalOverlay" class="modal-overlay" onclick="closeModalOverlay(event)"></div>
    
    <!-- Add Modal -->
    <div id="addModal" class="modal">
        <div class="modal-header">
            <div class="modal-title">New Resource</div>
            <button class="modal-close" onclick="closeModal('addModal')">✕</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label class="form-label">Title</label>
                <input type="text" class="form-input" id="resourceTitle" placeholder="Enter resource title">
            </div>
            <div class="form-group">
                <label class="form-label">Link Type</label>
                <select class="form-select" id="linkType" onchange="updatePlaceholder()">
                    <option value="embed">Embedded Document</option>
                    <option value="share">External Link</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">SharePoint URL</label>
                <input type="url" class="form-input" id="resourceLink" placeholder="Paste SharePoint URL or iframe code">
                <div class="form-help">You can paste the entire iframe code or just the URL</div>
            </div>
            <div class="form-group">
                <label class="form-label">Tags</label>
                <div class="tag-selector" id="tagSelector"></div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="closeModal('addModal')">Cancel</button>
            <button class="btn btn-primary" onclick="saveResource()">Save</button>
        </div>
    </div>

    <!-- Tag Modal -->
    <div id="tagModal" class="modal">
        <div class="modal-header">
            <div class="modal-title">Manage Tags</div>
            <button class="modal-close" onclick="closeModal('tagModal')">✕</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label class="form-label">Add New Tag</label>
                <div style="display: flex; gap: 8px;">
                    <input type="text" class="form-input" id="newTagInput" placeholder="Tag name" style="flex: 1;">
                    <button class="btn btn-primary" onclick="addTag()">Add</button>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Existing Tags</label>
                <div class="tag-list" id="tagList"></div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" onclick="closeModal('tagModal')">Done</button>
        </div>
    </div>

    <!-- View Modal -->
    <div id="viewModal" class="modal wide">
        <div class="modal-header">
            <div class="modal-title" id="viewTitle">Document Viewer</div>
            <button class="modal-close" onclick="closeModal('viewModal')">✕</button>
        </div>
        <div class="modal-body" style="padding: 0;">
            <iframe id="viewerFrame" class="viewer-frame"></iframe>
        </div>
    </div>

    <script>
        // Data
        let resources = [];
        let tags = ['Training', 'Documentation', 'Policy', 'Procedure', 'Tutorial', 'Reference'];
        let activeFilters = [];

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            renderResources();
            renderTagFilters();
        });

        // Show message
        function showMessage(text, type = 'info') {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = `message ${type}`;
            msg.classList.add('show');
            setTimeout(() => msg.classList.remove('show'), 3000);
        }

        // Load data
        function loadData() {
            const savedResources = localStorage.getItem('trainingResources');
            const savedTags = localStorage.getItem('trainingTags');
            if (savedResources) resources = JSON.parse(savedResources);
            if (savedTags) tags = JSON.parse(savedTags);
        }

        // Save data
        function saveData() {
            localStorage.setItem('trainingResources', JSON.stringify(resources));
            localStorage.setItem('trainingTags', JSON.stringify(tags));
        }

        // Render resources
        function renderResources() {
            const list = document.getElementById('resourceList');
            const items = document.getElementById('resourceItems');
            const empty = document.getElementById('emptyState');
            
            let filtered = resources;
            
            // Search
            const search = document.getElementById('searchInput').value.toLowerCase();
            if (search) {
                filtered = filtered.filter(r => 
                    r.title.toLowerCase().includes(search) ||
                    r.tags.some(t => t.toLowerCase().includes(search))
                );
            }
            
            // Filter tags
            if (activeFilters.length > 0) {
                filtered = filtered.filter(r =>
                    activeFilters.every(f => r.tags.includes(f))
                );
            }
            
            if (filtered.length === 0) {
                list.style.display = 'none';
                empty.style.display = 'block';
                return;
            }
            
            list.style.display = 'block';
            empty.style.display = 'none';
            
            items.innerHTML = filtered.map(r => `
                <div class="list-item">
                    <div class="item-icon">${r.linkType === 'embed' ? '📄' : '🔗'}</div>
                    <div class="item-title">${r.title}</div>
                    <div class="item-type">${r.linkType === 'embed' ? 'Embedded' : 'External'}</div>
                    <div class="item-tags">
                        ${r.tags.map(t => `<span class="item-tag">${t}</span>`).join('')}
                    </div>
                    <div class="item-actions">
                        ${r.linkType === 'embed' 
                            ? `<button class="icon-btn" onclick="viewResource(${resources.indexOf(r)})" title="View">👁️</button>`
                            : `<button class="icon-btn" onclick="window.open('${r.link}', '_blank')" title="Open">↗️</button>`
                        }
                        <button class="icon-btn" onclick="deleteResource(${resources.indexOf(r)})" title="Delete">🗑️</button>
                    </div>
                </div>
            `).join('');
        }

        // Render tag filters
        function renderTagFilters() {
            const container = document.getElementById('tagFilters');
            container.innerHTML = tags.map(tag => `
                <span class="tag-filter ${activeFilters.includes(tag) ? 'active' : ''}" 
                      onclick="toggleFilter('${tag}')">${tag}</span>
            `).join('');
        }

        // Toggle filter
        function toggleFilter(tag) {
            const idx = activeFilters.indexOf(tag);
            if (idx > -1) activeFilters.splice(idx, 1);
            else activeFilters.push(tag);
            renderTagFilters();
            renderResources();
        }

        // Filter resources
        function filterResources() {
            renderResources();
        }

        // Modal functions
        function openAddModal() {
            document.getElementById('modalOverlay').classList.add('active');
            document.getElementById('addModal').classList.add('active');
            renderTagSelector();
        }

        function openTagModal() {
            document.getElementById('modalOverlay').classList.add('active');
            document.getElementById('tagModal').classList.add('active');
            renderTagList();
        }

        function closeModal(id) {
            document.getElementById('modalOverlay').classList.remove('active');
            document.getElementById(id).classList.remove('active');
            if (id === 'viewModal') {
                document.getElementById('viewerFrame').src = '';
            }
        }

        function closeModalOverlay(e) {
            if (e.target.id === 'modalOverlay') {
                document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
                document.getElementById('modalOverlay').classList.remove('active');
                document.getElementById('viewerFrame').src = '';
            }
        }

        // Render tag selector
        function renderTagSelector() {
            const selector = document.getElementById('tagSelector');
            selector.innerHTML = tags.map(tag => `
                <span class="tag-option" onclick="toggleTagSelection('${tag}')">${tag}</span>
            `).join('');
        }

        // Toggle tag selection
        function toggleTagSelection(tag) {
            event.target.classList.toggle('selected');
        }

        // Update placeholder
        function updatePlaceholder() {
            const type = document.getElementById('linkType').value;
            const input = document.getElementById('resourceLink');
            input.placeholder = type === 'embed' 
                ? 'Paste SharePoint embed URL or iframe code'
                : 'Paste SharePoint sharing link';
        }

        // Save resource
        function saveResource() {
            const title = document.getElementById('resourceTitle').value.trim();
            let link = document.getElementById('resourceLink').value.trim();
            const linkType = document.getElementById('linkType').value;
            const selectedTags = Array.from(document.querySelectorAll('#tagSelector .tag-option.selected'))
                .map(el => el.textContent);
            
            if (!title || !link || selectedTags.length === 0) {
                showMessage('Please fill in all fields and select at least one tag', 'error');
                return;
            }
            
            // Extract URL from iframe
            if (link.includes('<iframe') && link.includes('src=')) {
                const match = link.match(/src=["']([^"']+)["']/);
                if (match && match[1]) {
                    link = match[1];
                } else {
                    showMessage('Could not extract URL from iframe code', 'error');
                    return;
                }
            }
            
            // Validate URL
            try {
                new URL(link);
            } catch (e) {
                showMessage('Please enter a valid URL', 'error');
                return;
            }
            
            resources.push({
                id: Date.now(),
                title,
                link,
                linkType,
                tags: selectedTags,
                createdAt: new Date().toISOString()
            });
            
            saveData();
            renderResources();
            closeModal('addModal');
            showMessage('Resource added successfully', 'success');
            
            // Reset form
            document.getElementById('resourceTitle').value = '';
            document.getElementById('resourceLink').value = '';
            document.getElementById('linkType').value = 'embed';
        }

        // View resource
        function viewResource(index) {
            const resource = resources[index];
            document.getElementById('viewTitle').textContent = resource.title;
            document.getElementById('viewerFrame').src = resource.link;
            document.getElementById('modalOverlay').classList.add('active');
            document.getElementById('viewModal').classList.add('active');
        }

        // Delete resource
        function deleteResource(index) {
            if (confirm('Are you sure you want to delete this resource?')) {
                resources.splice(index, 1);
                saveData();
                renderResources();
                showMessage('Resource deleted', 'success');
            }
        }

        // Render tag list
        function renderTagList() {
            const list = document.getElementById('tagList');
            list.innerHTML = tags.map(tag => `
                <div class="tag-list-item">
                    <span>${tag}</span>
                    <button class="icon-btn" onclick="removeTag('${tag}')" title="Remove">✕</button>
                </div>
            `).join('');
        }

        // Add tag
        function addTag() {
            const input = document.getElementById('newTagInput');
            const tagName = input.value.trim();
            
            if (!tagName) {
                showMessage('Please enter a tag name', 'error');
                return;
            }
            
            if (tags.includes(tagName)) {
                showMessage('Tag already exists', 'error');
                return;
            }
            
            tags.push(tagName);
            saveData();
            renderTagList();
            renderTagFilters();
            input.value = '';
            showMessage('Tag added successfully', 'success');
        }

        // Remove tag
        function removeTag(tag) {
            const inUse = resources.some(r => r.tags.includes(tag));
            
            if (inUse) {
                if (!confirm(`The tag "${tag}" is being used. Removing it will also remove it from resources. Continue?`)) {
                    return;
                }
                
                resources.forEach(r => {
                    const idx = r.tags.indexOf(tag);
                    if (idx > -1) r.tags.splice(idx, 1);
                });
            }
            
            tags = tags.filter(t => t !== tag);
            activeFilters = activeFilters.filter(f => f !== tag);
            
            saveData();
            renderTagList();
            renderTagFilters();
            renderResources();
            showMessage('Tag removed', 'success');
        }

        // Export data
        function exportData() {
            const data = {
                version: '1.0',
                exportDate: new Date().toISOString(),
                resources,
                tags
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `resources-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showMessage('Data exported successfully', 'success');
        }

        // Import data
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (!data.resources || !data.tags) {
                        showMessage('Invalid file format', 'error');
                        return;
                    }
                    
                    if (confirm('This will replace all existing data. Continue?')) {
                        resources = data.resources;
                        tags = data.tags;
                        saveData();
                        renderResources();
                        renderTagFilters();
                        showMessage('Data imported successfully', 'success');
                    }
                } catch (error) {
                    showMessage('Error importing file', 'error');
                }
            };
            reader.readAsText(file);
            
            event.target.value = '';
        }

        // PWA
        if ('serviceWorker' in navigator && window.location.protocol !== 'file:') {
            navigator.serviceWorker.register('sw.js').catch(err => {
                console.log('Service Worker registration failed:', err);
            });
        }
    </script>
</body>
</html>